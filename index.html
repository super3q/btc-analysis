<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BTC æ™ºèƒ½æ–æ³¢é‚£å¥‘åˆ†æå„€è¡¨æ¿</title>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; background-color: #131722; color: #d1d4dc; margin: 0; padding: 20px; }
        .container { max-width: 1400px; margin: 0 auto; }
        h1 { text-align: center; color: #F0B90B; margin-bottom: 20px; font-weight: 700; }
        h2 { border-left: 4px solid #F0B90B; padding-left: 10px; margin-top: 0; color: #fff; }
        
        /* ç‰ˆé¢é…ç½® */
        .grid-top { display: grid; grid-template-columns: 3fr 1fr; gap: 20px; margin-bottom: 20px; }
        .grid-mid { display: grid; grid-template-columns: 1fr; gap: 20px; margin-bottom: 20px; }
        .grid-bottom { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 20px; }
        
        .card { background: #1e222d; border-radius: 12px; padding: 20px; box-shadow: 0 4px 6px rgba(0,0,0,0.3); }
        .chart-box { height: 600px; }
        .gauge-box { height: 600px; }
        .info-box { height: auto; min-height: 250px; }

        /* æ–æ³¢é‚£å¥‘è¨ˆç®—æ©Ÿæ¨£å¼ */
        .fib-controls { display: flex; gap: 10px; margin-bottom: 15px; border-bottom: 1px solid #2a2e39; padding-bottom: 15px; }
        .fib-btn { 
            background: #2a2e39; color: #aaa; border: 1px solid #434651; padding: 8px 20px; 
            border-radius: 4px; cursor: pointer; font-weight: bold; transition: 0.3s; 
        }
        .fib-btn:hover { background: #363a45; color: #fff; }
        .fib-btn.active { background: #F0B90B; color: #000; border-color: #F0B90B; }
        
        .fib-table-container { overflow-x: auto; }
        .fib-table { width: 100%; border-collapse: collapse; text-align: center; }
        .fib-table th { background: #2a2e39; color: #aaa; padding: 12px; font-size: 0.9rem; }
        .fib-table td { padding: 12px; border-bottom: 1px solid #2a2e39; font-size: 1.1rem; font-family: 'Roboto Mono', monospace; }
        
        /* æ–æ³¢é‚£å¥‘é¡è‰²å¼·èª¿ */
        .fib-row-golden { background: rgba(240, 185, 11, 0.1); }
        .fib-ratio { color: #F0B90B; font-weight: bold; }
        .fib-price { color: #fff; font-weight: bold; }
        .fib-desc { font-size: 0.85rem; color: #787b86; }
        
        .trend-up { color: #00c853; }
        .trend-down { color: #ff5252; }

        /* Ahr999 èˆ‡æƒ…ç·’æŒ‰éˆ• */
        .btn-link {
            display: inline-block; width: 100%; box-sizing: border-box;
            background-color: #2a2e39; border: 1px solid #F0B90B; color: #F0B90B;
            padding: 10px 0; text-decoration: none; border-radius: 5px; font-weight: bold;
            margin-top: 10px; text-align: center; transition: 0.3s;
        }
        .btn-link:hover { background-color: #F0B90B; color: #000; }
        
        /* éŸ¿æ‡‰å¼ */
        @media (max-width: 1024px) {
            .grid-top, .grid-bottom { grid-template-columns: 1fr; }
            .chart-box, .gauge-box { height: 500px; }
        }
    </style>
</head>
<body>

<div class="container">
    <h1>BTC/USDT æ™ºèƒ½æ–æ³¢é‚£å¥‘åˆ†æå„€è¡¨æ¿</h1>

    <div class="grid-top">
        <div class="card chart-box">
            <h3 style="margin-top:0; color:#eee;">ğŸ“ˆ å³æ™‚èµ°å‹¢ (å« MACD, RSI, VOL)</h3>
            <div class="tradingview-widget-container" style="height:calc(100% - 40px);width:100%">
                <div class="tradingview-widget-container__widget" style="height:100%;width:100%"></div>
                <script type="text/javascript" src="https://s3.tradingview.com/external-embedding/embed-widget-advanced-chart.js" async>
                {
                "autosize": true,
                "symbol": "BINANCE:BTCUSDT",
                "interval": "D",
                "timezone": "Asia/Taipei",
                "theme": "dark",
                "style": "1",
                "locale": "zh_TW",
                "enable_publishing": false,
                "withdateranges": true,
                "hide_side_toolbar": false,
                "details": true,
                "studies": ["MACD@tv-basicstudies","RSI@tv-basicstudies","StochasticRSI@tv-basicstudies","Volume@tv-basicstudies"],
                "support_host": "https://www.tradingview.com"
                }
                </script>
            </div>
        </div>
        
        <div class="card gauge-box">
            <h3 style="margin-top:0; color:#eee;">âš¡ è²·è³£åŠ›é“æŒ‡é‡</h3>
            <div class="tradingview-widget-container" style="height:calc(100% - 40px);width:100%">
                <div class="tradingview-widget-container__widget" style="height:100%;width:100%"></div>
                <script type="text/javascript" src="https://s3.tradingview.com/external-embedding/embed-widget-technical-analysis.js" async>
                {
                "interval": "1D",
                "width": "100%",
                "isTransparent": true,
                "height": "100%",
                "symbol": "BINANCE:BTCUSDT",
                "showIntervalTabs": true,
                "displayMode": "single",
                "locale": "zh_TW",
                "colorTheme": "dark"
                }
                </script>
            </div>
        </div>
    </div>

    <div class="grid-mid">
        <div class="card">
            <h2>ğŸ“ æ–æ³¢é‚£å¥‘å›æ¸¬æ™ºèƒ½è¨ˆç®— (Fibonacci Retracement)</h2>
            <p style="color:#aaa; font-size:0.9rem;">ç³»çµ±è‡ªå‹•æŠ“å– Binance æ­·å²æ•¸æ“šï¼Œè¨ˆç®—è©²å€é–“çš„æœ€é«˜åƒ¹(100%)èˆ‡æœ€ä½åƒ¹(0%)ï¼Œä¸¦æ¨ç®—å‡ºé—œéµæ”¯æ’å›èª¿ä½ã€‚</p>
            
            <div class="fib-controls">
                <button class="fib-btn active" onclick="calculateFib(30, this)">è¿‘ 1 å€‹æœˆ</button>
                <button class="fib-btn" onclick="calculateFib(90, this)">è¿‘ 3 å€‹æœˆ</button>
                <button class="fib-btn" onclick="calculateFib(180, this)">è¿‘ 6 å€‹æœˆ</button>
                <button class="fib-btn" onclick="calculateFib(365, this)">è¿‘ 1 å¹´</button>
                <span id="loading-text" style="display:none; color:#F0B90B; align-self: center; margin-left: 10px;">æ•¸æ“šè¨ˆç®—ä¸­...</span>
            </div>

            <div class="fib-table-container">
                <table class="fib-table">
                    <thead>
                        <tr>
                            <th>æ¯”ä¾‹ (Ratio)</th>
                            <th>åƒ¹æ ¼ (Price)</th>
                            <th>æŠ€è¡“æ„ç¾©</th>
                            <th>å€é–“èªªæ˜</th>
                        </tr>
                    </thead>
                    <tbody id="fib-body">
                        </tbody>
                </table>
            </div>
            <p style="text-align:right; font-size:0.8rem; color:#555; margin-top:10px;">*æ•¸æ“šä¾†æº: Binance API (æ¯æ—¥æ›´æ–°)</p>
        </div>
    </div>

    <div class="grid-bottom">
        <div class="card info-box">
            <h3>ğŸ˜± ææ‡¼èˆ‡è²ªå©ªæŒ‡æ•¸</h3>
            <div style="text-align: center;">
                <img src="https://alternative.me/crypto/fear-and-greed-index.png" alt="Fear & Greed Index" style="width: 100%; max-width: 300px; border-radius: 8px;">
            </div>
        </div>

        <div class="card info-box">
            <h3>ğŸ’ Ahr999 å›¤å¹£æŒ‡æ¨™</h3>
            <p style="font-size:0.9rem; color:#ccc;">
                <span style="color:#00c853">â— &lt; 0.45 æŠ„åº•å€</span><br>
                <span style="color:#ffd600">â— 0.45-1.2 å®šæŠ•å€</span><br>
                <span style="color:#ff5252">â— &gt; 1.2 èµ·é£›å€(æš«åœè²·å…¥)</span>
            </p>
            <a href="https://www.coinglass.com/zh-TW/pro/i/ahr999" target="_blank" class="btn-link">æŸ¥çœ‹ Coinglass å³æ™‚æ•¸æ“š</a>
        </div>

        <div class="card info-box">
            <h3>ğŸ“ æ“ä½œå»ºè­° Summary</h3>
            <ul style="padding-left: 20px; line-height: 1.6; color: #ccc; font-size: 0.95rem;">
                <li><strong>å¼·æ”¯æ’ä½ï¼š</strong>åƒè€ƒä¸Šæ–¹è¡¨æ ¼çš„ <span style="color:#F0B90B">0.618</span> åƒ¹ä½ï¼Œè‹¥å¹£åƒ¹å›èª¿è‡³æ­¤æœªç ´ï¼Œç‚ºæœ€ä½³è²·é»ã€‚</li>
                <li><strong>åˆ†æ‰¹æ­¢ç›ˆï¼š</strong>è‹¥ RSI > 70 ä¸”åƒ¹æ ¼æ¥è¿‘ä¸Šæ–¹ <span style="color:#ff5252">100% (å‰é«˜)</span>ï¼Œå»ºè­°æ¸›å€‰ã€‚</li>
                <li><strong>è¶¨å‹¢åˆ¤æ–·ï¼š</strong>è‹¥ 0.5 (ä¸­è»¸) è¢«è·Œç ´ï¼Œè¶¨å‹¢å¯èƒ½è½‰å¼±ã€‚</li>
            </ul>
        </div>
    </div>
</div>

<script>
    // æ–æ³¢é‚£å¥‘è¨ˆç®—é‚è¼¯
    async function calculateFib(days, btnElement) {
        // æ›´æ–°æŒ‰éˆ•æ¨£å¼
        document.querySelectorAll('.fib-btn').forEach(b => b.classList.remove('active'));
        if(btnElement) btnElement.classList.add('active');
        
        const loading = document.getElementById('loading-text');
        loading.style.display = 'inline';

        try {
            // å‘¼å« Binance API ç²å– K ç·šæ•¸æ“š (1å¤© Kæ£’)
            const response = await fetch(`https://api.binance.com/api/v3/klines?symbol=BTCUSDT&interval=1d&limit=${days}`);
            const data = await response.json();

            // è§£ææ•¸æ“š: data[i][2] is High, data[i][3] is Low
            let maxPrice = -Infinity;
            let minPrice = Infinity;

            data.forEach(candle => {
                const high = parseFloat(candle[2]);
                const low = parseFloat(candle[3]);
                if (high > maxPrice) maxPrice = high;
                if (low < minPrice) minPrice = low;
            });

            // è¨ˆç®—æ–æ³¢é‚£å¥‘å›èª¿ä½ (å‡è¨­å¾ä½é»æ¼²åˆ°é«˜é»å¾Œçš„å›èª¿)
            // 0% = Low, 100% = High. å›èª¿æ˜¯ç”¨ High å¾€ä¸‹æ¸›
            // é€™è£¡å±•ç¤ºä¸€èˆ¬é€šç”¨çš„å›æ’¤æ”¯æ’ä½ï¼š
            // Level = High - (Range * ratio)
            const range = maxPrice - minPrice;
            
            const levels = [
                { ratio: 0, percent: "0% (æœ€ä½é»)", price: minPrice, desc: "å€é–“æœ€ä½æ”¯æ’ (Floor)", style: "color:#00c853" },
                { ratio: 0.236, percent: "23.6%", price: maxPrice - (range * 0.236), desc: "å¼·å‹¢æ•´ç†å€ (æ·ºå›èª¿)", style: "" },
                { ratio: 0.382, percent: "38.2%", price: maxPrice - (range * 0.382), desc: "ç¬¬ä¸€é“é‡è¦æ”¯æ’", style: "" },
                { ratio: 0.5, percent: "50%", price: maxPrice - (range * 0.5), desc: "å¤šç©ºåˆ†ç•Œç·š (ä¸­è»¸)", style: "font-weight:bold" },
                { ratio: 0.618, percent: "61.8%", price: maxPrice - (range * 0.618), desc: "é»ƒé‡‘å£è¢‹ (æœ€ä½³è²·é»)", style: "color:#F0B90B; font-weight:900;" },
                { ratio: 0.786, percent: "78.6%", price: maxPrice - (range * 0.786), desc: "æ·±å±¤å›èª¿ (æœ€å¾Œé˜²ç·š)", style: "" },
                { ratio: 1, percent: "100% (æœ€é«˜é»)", price: maxPrice, desc: "å€é–“æœ€é«˜å£“åŠ› (Ceiling)", style: "color:#ff5252" }
            ];

            // é‡æ–°æ’åºï¼Œè®“ 100% (é«˜åƒ¹) åœ¨ä¸Šé¢ï¼Œ0% (ä½åƒ¹) åœ¨ä¸‹é¢ï¼Œç¬¦åˆè¦–è¦ºé‚è¼¯
            levels.sort((a, b) => b.price - a.price);

            // æ¸²æŸ“è¡¨æ ¼
            const tbody = document.getElementById('fib-body');
            tbody.innerHTML = '';

            levels.forEach(lvl => {
                const rowClass = (lvl.ratio === 0.618 || lvl.ratio === 0.5) ? 'fib-row-golden' : '';
                const html = `
                    <tr class="${rowClass}">
                        <td class="fib-ratio" style="${lvl.style}">${lvl.percent}</td>
                        <td class="fib-price">${lvl.price.toFixed(2)}</td>
                        <td class="fib-desc" style="${lvl.style}">${lvl.desc}</td>
                        <td class="fib-desc">è·é›¢é«˜é»å›è½ ${(lvl.ratio * 100).toFixed(1)}%</td>
                    </tr>
                `;
                tbody.innerHTML += html;
            });

        } catch (error) {
            console.error(error);
            document.getElementById('fib-body').innerHTML = `<tr><td colspan="4" style="color:red; text-align:center;">ç„¡æ³•ç²å–æ•¸æ“šï¼Œè«‹ç¨å¾Œå†è©¦ (APIé€£ç·šé™åˆ¶)</td></tr>`;
        } finally {
            loading.style.display = 'none';
        }
    }

    // åˆå§‹åŒ–ï¼šé è¨­è¼‰å…¥ 30 å¤©æ•¸æ“š
    window.onload = function() {
        calculateFib(30, document.querySelector('.fib-btn'));
    };
</script>

</body>
</html>
