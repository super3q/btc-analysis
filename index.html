<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Crypto AI Command Center (Speed Ver.)</title>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, "Microsoft JhengHei", "Segoe UI", Roboto, sans-serif; background-color: #131722; color: #d1d4dc; margin: 0; padding: 20px; }
        .container { max-width: 1600px; margin: 0 auto; }
        
        /* Header */
        .header-section { display: flex; flex-direction: column; align-items: center; margin-bottom: 25px; }
        h1 { color: #F0B90B; margin: 0 0 15px 0; font-weight: 700; letter-spacing: 1px; text-align: center; }
        
        /* Coin Switcher */
        .coin-switcher { display: flex; gap: 8px; background: #1e222d; padding: 8px; border-radius: 30px; flex-wrap: wrap; justify-content: center; }
        .coin-btn { background: transparent; border: none; color: #aaa; padding: 8px 20px; border-radius: 20px; cursor: pointer; font-size: 1rem; font-weight: bold; transition: 0.3s; }
        .coin-btn:hover { color: #fff; background: rgba(255,255,255,0.1); }
        .coin-btn.active { background: #F0B90B; color: #000; box-shadow: 0 2px 10px rgba(240, 185, 11, 0.3); }

        /* Grid Layout */
        .grid-top { display: grid; grid-template-columns: 3fr 1fr; gap: 20px; margin-bottom: 20px; }
        .grid-news-ai { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px; }
        
        .card { background: #1e222d; border-radius: 8px; padding: 20px; box-shadow: 0 4px 6px rgba(0,0,0,0.2); border: 1px solid #2a2e39; position: relative; }
        .chart-box, .gauge-box, .news-container { height: 600px; }
        .news-container { overflow: hidden; }

        /* AI Zone Styles (Updated) */
        .ai-zone { display: flex; flex-direction: column; gap: 15px; height: 100%; }
        .ai-input-area { background: #2a2e39; padding: 15px; border-radius: 8px; border: 1px solid #434651; display: flex; flex-direction: column; gap: 10px; }
        
        .ai-input-area textarea {
            width: 100%; height: 100px; background: #131722; border: 1px solid #555; color: #fff; 
            padding: 10px; border-radius: 4px; box-sizing: border-box; resize: none; font-size: 1rem;
        }
        
        /* The Magic Button */
        .magic-btn {
            background: linear-gradient(135deg, #F0B90B 0%, #ff9800 100%);
            color: #000; border: none; padding: 15px; border-radius: 8px;
            font-size: 1.1rem; font-weight: 800; cursor: pointer;
            box-shadow: 0 4px 15px rgba(240, 185, 11, 0.4);
            transition: transform 0.1s, box-shadow 0.1s;
            display: flex; align-items: center; justify-content: center; gap: 10px;
        }
        .magic-btn:active { transform: scale(0.98); box-shadow: 0 2px 5px rgba(240, 185, 11, 0.2); }
        .magic-btn:hover { filter: brightness(1.1); }

        .instruction-step { font-size: 0.85rem; color: #888; text-align: center; margin-top: 5px; }

        /* AI Result Display */
        .ai-result-display {
            flex-grow: 1; background: #131722; border: 1px solid #F0B90B; border-radius: 8px; padding: 20px;
            position: relative; overflow-y: auto;
        }
        .result-title { color: #F0B90B; font-size: 1.1rem; margin-bottom: 10px; border-bottom: 1px solid #333; padding-bottom: 10px;}
        .result-content { font-size: 0.95rem; line-height: 1.6; color: #ccc; white-space: pre-wrap; }

        /* Fib Styles */
        .fib-controls { display: flex; gap: 10px; margin-bottom: 15px; border-bottom: 1px solid #2a2e39; padding-bottom: 15px; }
        .fib-btn { background: #2a2e39; color: #aaa; border: 1px solid #434651; padding: 6px 15px; border-radius: 4px; cursor: pointer; transition: 0.3s; }
        .fib-btn.active { background: #F0B90B; color: #000; border-color: #F0B90B; font-weight: bold; }
        .fib-table { width: 100%; border-collapse: collapse; text-align: left; }
        .fib-table td, .fib-table th { padding: 10px; border-bottom: 1px solid #2a2e39; }
        .row-golden { background: rgba(240, 185, 11, 0.08); }

        @media (max-width: 1024px) {
            .grid-top, .grid-news-ai { grid-template-columns: 1fr; }
            .chart-box, .gauge-box, .news-container { height: 500px; }
        }
    </style>
</head>
<body>

<div class="container">
    <div class="header-section">
        <h1>åŠ å¯†è²¨å¹£ AI æˆ°æƒ…ä¸­å¿ƒ (æ¥µé€Ÿç‰ˆ)</h1>
        <div class="coin-switcher">
            <button class="coin-btn active" onclick="switchCoin('BTC')">BTC</button>
            <button class="coin-btn" onclick="switchCoin('ETH')">ETH</button>
            <button class="coin-btn" onclick="switchCoin('SOL')">SOL</button>
            <button class="coin-btn" onclick="switchCoin('BNB')">BNB</button>
            <button class="coin-btn" onclick="switchCoin('DOGE')">DOGE</button>
        </div>
    </div>

    <div class="grid-top">
        <div class="card chart-box">
            <h3 style="margin-top:0; color:#eee;">ğŸ“ˆ <span class="coin-name">BTC</span>/USDT æŠ€è¡“èµ°å‹¢</h3>
            <div id="tv-chart-container" style="height:calc(100% - 30px);width:100%"></div>
        </div>
        <div class="card gauge-box">
            <h3 style="margin-top:0; color:#eee;">âš¡ å¤šç©ºåŠ›é“è©•ç´š</h3>
            <div id="tv-gauge-container" style="height:calc(100% - 30px);width:100%"></div>
        </div>
    </div>

    <div class="card" style="margin-bottom: 20px;">
        <h3 style="margin:0 0 15px 0; color:#eee;">ğŸ“ æ–æ³¢é‚£å¥‘æ™ºèƒ½å›æ¸¬</h3>
        <div class="fib-controls">
            <button class="fib-btn active" onclick="calculateFib(30, this)">è¿‘ 30 å¤©</button>
            <button class="fib-btn" onclick="calculateFib(90, this)">è¿‘ 90 å¤©</button>
            <button class="fib-btn" onclick="calculateFib(180, this)">è¿‘ 180 å¤©</button>
            <span id="loading-text" style="display:none; color:#F0B90B; margin-left:10px;">è¨ˆç®—ä¸­...</span>
        </div>
        <table class="fib-table">
            <tbody id="fib-body"></tbody>
        </table>
    </div>

    <div class="grid-news-ai">
        <div class="card news-container">
            <h3 style="margin-top:0; color:#eee;">ğŸ“° å³æ™‚è§€é» (è¤‡è£½æ¨™é¡Œ -> è²¼åˆ°å³é‚Š)</h3>
            <div class="tradingview-widget-container">
                <div class="tradingview-widget-container__widget"></div>
                <script type="text/javascript" src="https://s3.tradingview.com/external-embedding/embed-widget-timeline.js" async>
                {
                "feedMode": "market",
                "market": "crypto",
                "isTransparent": true,
                "displayMode": "regular",
                "width": "100%",
                "height": "550",
                "colorTheme": "dark",
                "locale": "zh_TW"
                }
                </script>
            </div>
        </div>

        <div class="card">
            <h3 style="margin-top:0; color:#eee;">ğŸ¤– Google AI æŠ•è³‡çµè«–åˆ†æ</h3>
            <div class="ai-zone">
                <div class="ai-input-area">
                    <textarea id="ai-input" placeholder="åœ¨æ­¤è²¼ä¸Šæ–°èå…§å®¹æˆ–æ¨™é¡Œ..."></textarea>
                    
                    <button id="magic-btn" class="magic-btn" onclick="copyAndGo()">
                        <span>âš¡ å…¨é¸è¤‡è£½ ï¼† é–‹å•Ÿ Gemini åˆ†æ</span>
                    </button>
                    
                    <div class="instruction-step">
                        æ­¥é©Ÿï¼šé»æ“ŠæŒ‰éˆ• â¤ æ–°è¦–çª—è²¼ä¸Š (Ctrl+V) â¤ æŒ‰ Enter
                    </div>
                </div>

                <div class="ai-result-display">
                    <div class="result-title">AI çµè«–ç­†è¨˜æ¬„</div>
                    <div contenteditable="true" class="result-content" style="outline:none; min-height:100px;">
                        (åˆ†æå®Œç•¢å¾Œï¼Œå¯å°‡é‡é»è²¼å›æ­¤è™•ä¿å­˜...)
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    let currentCoin = 'BTC';
    let currentSymbol = 'BTCUSDT';

    window.onload = function() {
        switchCoin('BTC');
    };

    function switchCoin(coin) {
        currentCoin = coin;
        currentSymbol = coin + 'USDT';
        document.querySelectorAll('.coin-name').forEach(el => el.innerText = coin);
        document.querySelectorAll('.coin-btn').forEach(btn => btn.classList.toggle('active', btn.innerText === coin));
        reloadWidgets(currentSymbol);
        document.querySelectorAll('.fib-btn').forEach(b => b.classList.remove('active'));
        document.querySelectorAll('.fib-btn')[0].classList.add('active');
        calculateFib(30);
    }

    function reloadWidgets(symbol) {
        document.getElementById('tv-chart-container').innerHTML = '';
        const scriptChart = document.createElement('script');
        scriptChart.src = 'https://s3.tradingview.com/external-embedding/embed-widget-advanced-chart.js';
        scriptChart.async = true;
        scriptChart.innerHTML = JSON.stringify({
            "autosize": true, "symbol": "BINANCE:" + symbol, "interval": "D", "timezone": "Asia/Taipei", "theme": "dark", "style": "1", "locale": "zh_TW", "enable_publishing": false, "withdateranges": true, "hide_side_toolbar": false,
            "studies": ["MACD@tv-basicstudies","RSI@tv-basicstudies","StochasticRSI@tv-basicstudies"],
            "support_host": "https://www.tradingview.com"
        });
        document.getElementById('tv-chart-container').appendChild(scriptChart);

        document.getElementById('tv-gauge-container').innerHTML = '';
        const scriptGauge = document.createElement('script');
        scriptGauge.src = 'https://s3.tradingview.com/external-embedding/embed-widget-technical-analysis.js';
        scriptGauge.async = true;
        scriptGauge.innerHTML = JSON.stringify({
            "interval": "1D", "width": "100%", "height": "100%", "isTransparent": true, "symbol": "BINANCE:" + symbol, "showIntervalTabs": true, "displayMode": "single", "locale": "zh_TW", "colorTheme": "dark"
        });
        document.getElementById('tv-gauge-container').appendChild(scriptGauge);
    }

    // --- âš¡ æ ¸å¿ƒåŠŸèƒ½ï¼šä¸€éµè¤‡è£½ä¸¦é–‹å•Ÿ ---
    function copyAndGo() {
        const input = document.getElementById('ai-input').value;
        if(!input) { alert("è«‹å…ˆè²¼ä¸Šæ–°èå…§å®¹ï¼"); return; }
        
        // 1. ç”Ÿæˆå°ˆæ¥­æŒ‡ä»¤
        const fullPrompt = `ä½ ç¾åœ¨æ˜¯åŠ å¯†è²¨å¹£é ‚ç´šåˆ†æå¸«ã€‚è«‹é‡å°ä»¥ä¸‹å¸‚å ´æ¶ˆæ¯ï¼šã€Œ${input}ã€é€²è¡Œæ·±åº¦åˆ†æã€‚è«‹çµ¦å‡ºï¼š1. å°æ–¼ ${currentCoin} çš„è¶¨å‹¢å½±éŸ¿ï¼ˆçœ‹å¤š/çœ‹ç©º/ä¸­ç«‹ï¼‰ã€‚2. å»ºè­°çš„é—œéµæ”¯æ’èˆ‡å£“åŠ›ä½ã€‚3. çµ¦æŠ•è³‡è€…çš„å…·é«”æ“ä½œå»ºè­°ï¼ˆçµè«–ï¼‰ã€‚è«‹ç”¨ç¹é«”ä¸­æ–‡å›ç­”ï¼Œèªæ°£å°ˆæ¥­ä¸”ç²¾ç°¡ã€‚`;
        
        // 2. å¯«å…¥å‰ªè²¼ç°¿
        navigator.clipboard.writeText(fullPrompt).then(() => {
            
            // 3. æŒ‰éˆ•è¦–è¦ºå›é¥‹
            const btn = document.getElementById('magic-btn');
            const originalText = btn.innerHTML;
            btn.style.background = "#0ECB81"; // è®Šç¶ è‰²
            btn.innerHTML = "<span>âœ… å·²è¤‡è£½ï¼æ­£åœ¨é–‹å•Ÿ...</span>";
            
            // 4. å»¶é²ä¸€ä¸‹è®“ä½¿ç”¨è€…çœ‹åˆ°æˆåŠŸï¼Œç„¶å¾Œé–‹å•Ÿç¶²é 
            setTimeout(() => {
                window.open('https://gemini.google.com/app', '_blank');
                // å¾©åŸæŒ‰éˆ•
                btn.style.background = "linear-gradient(135deg, #F0B90B 0%, #ff9800 100%)";
                btn.innerHTML = originalText;
            }, 800);

        }).catch(err => {
            alert("è¤‡è£½å¤±æ•—ï¼Œè«‹æ‰‹å‹•è¤‡è£½ã€‚");
        });
    }

    // Fibonacci Calculation
    async function calculateFib(days, btnElement) {
        if(btnElement) {
            document.querySelectorAll('.fib-btn').forEach(b => b.classList.remove('active'));
            btnElement.classList.add('active');
        }
        document.getElementById('loading-text').style.display = 'inline';
        try {
            const res = await fetch(`https://api.binance.com/api/v3/klines?symbol=${currentSymbol}&interval=1d&limit=${days}`);
            const data = await res.json();
            let max = -Infinity, min = Infinity;
            data.forEach(d => {
                const h = parseFloat(d[2]), l = parseFloat(d[3]);
                if(h > max) max = h;
                if(l < min) min = l;
            });
            const current = parseFloat(data[data.length-1][4]);
            const diff = max - min;
            const levels = [
                {r:1, p:max, t:"å‰é«˜"},
                {r:0.618, p:max-(diff*0.618), t:"é»ƒé‡‘æ”¯æ’"},
                {r:0.5, p:max-(diff*0.5), t:"ä¸­è»¸"},
                {r:0, p:min, t:"å‰ä½"}
            ];
            let html = "";
            levels.forEach(l => {
                const dist = ((current - l.p)/l.p*100).toFixed(2);
                html += `<tr class="${l.r===0.618?'row-golden':''}">
                    <td>${l.r*100}%</td>
                    <td style="font-weight:bold; color:#fff;">$${l.p.toFixed(2)}</td>
                    <td style="color:#aaa;">${l.t}</td>
                    <td style="color:${dist>0?'#0ECB81':'#F6465D'}">${dist>0?'+':''}${dist}%</td>
                </tr>`;
            });
            document.getElementById('fib-body').innerHTML = html;
        } catch(e) {}
        document.getElementById('loading-text').style.display = 'none';
    }
</script>

</body>
</html>
