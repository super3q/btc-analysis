<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Taiwan Stock AI Analyst (v5.2 Macro)</title>
    <style>
        /* åŸºç¤è¨­å®š */
        body { font-family: "Microsoft JhengHei", Arial, sans-serif; background-color: #131722; color: #d1d4dc; margin: 0; padding: 20px; }
        .container { max-width: 1600px; margin: 0 auto; }
        
        /* æ¨™é¡Œå€ */
        .header { text-align: center; margin-bottom: 20px; }
        h1 { 
            background: linear-gradient(90deg, #FF5252, #FF1744); 
            -webkit-background-clip: text; -webkit-text-fill-color: transparent;
            margin: 0; font-size: 2rem; letter-spacing: 2px;
        }
        .subtitle { font-size: 0.9rem; color: #888; margin-top: 5px; }
        
        /* æ§åˆ¶å€ */
        .controls { display: flex; flex-direction: column; align-items: center; gap: 15px; margin-bottom: 20px; }
        
        /* æœå°‹æ¡† */
        .search-box { display: flex; gap: 10px; background: #1e222d; padding: 10px 20px; border-radius: 50px; border: 1px solid #434651; }
        .search-input { background: transparent; border: none; color: #fff; font-size: 1.1rem; outline: none; width: 250px; text-transform: uppercase; }
        .search-btn { background: #FF5252; color: white; border: none; padding: 8px 20px; border-radius: 20px; cursor: pointer; font-weight: bold; }
        .search-btn:hover { background: #FF1744; }

        /* æŒ‰éˆ•ç¾¤çµ„ */
        .btn-group { display: flex; gap: 8px; flex-wrap: wrap; justify-content: center; }
        .btn { background: #2a2e39; color: #b2b5be; border: 1px solid #434651; padding: 6px 15px; border-radius: 8px; cursor: pointer; transition: 0.2s; }
        .btn:hover { color: #fff; border-color: #FF5252; }
        .btn.active { background: #FF5252; color: white; border-color: #FF5252; }

        /* ç¶²æ ¼ä½ˆå±€ */
        .grid-top { display: grid; grid-template-columns: 2.5fr 1fr; gap: 20px; height: 600px; margin-bottom: 20px; }
        .grid-mid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; height: 500px; margin-bottom: 20px; }
        .grid-bottom { display: grid; grid-template-columns: 2fr 1fr; gap: 20px; height: 500px; margin-bottom: 20px; } /* å·¦å¯¬å³çª„ */
        
        .card { background: #1e222d; border-radius: 8px; overflow: hidden; position: relative; border: 1px solid #2a2e39; display: flex; flex-direction: column; }
        .card-header { padding: 10px 15px; background: #2a2e39; font-weight: bold; display: flex; justify-content: space-between; align-items: center; }
        .card-header .badge { font-size: 0.75rem; background: #FF5252; color: white; padding: 2px 6px; border-radius: 4px; font-weight: normal; }
        
        /* Widget å®¹å™¨ (å¼·åˆ¶æ»¿ç‰ˆ) */
        .widget-content { flex-grow: 1; position: relative; width: 100%; height: 100%; }

        /* ç­–ç•¥æ–‡å­—å€ */
        .strategy-text p { margin: 8px 0; line-height: 1.5; color: #b2b5be; font-size: 0.95rem; }
        .strategy-text strong { color: #fff; font-size: 1.1rem; display: block; margin-bottom: 4px; border-left: 3px solid #FF5252; padding-left: 8px; }
        .up { color: #FF5252; font-weight: bold; }
        .down { color: #0ECB81; font-weight: bold; } /* å°è‚¡ç¶ æ¼²ç´…è·Œï¼Œä½†åœ¨åœ‹éš›å®è§€é€šå¸¸ç´…è·Œç¶ æ¼²ï¼Œé€™è£¡ä¾æ“šå°ç£ç¿’æ…£ï¼šç´…æ¼²ç¶ è·Œä¿®æ­£ */
        /* ä¿®æ­£ï¼šå°è‚¡ç¿’æ…£ ç´…=æ¼²(Bull), ç¶ =è·Œ(Bear)ã€‚ä½†åœ¨å®è§€è§£è®€ç¾å…ƒå°å°è‚¡å½±éŸ¿æ™‚ï¼š
           ç¾å…ƒæ¼²(ç´…) -> å°è‚¡è·Œ(ç¶ )
           ç¾å…ƒè·Œ(ç¶ ) -> å°è‚¡æ¼²(ç´…)
        */

        /* éŸ¿æ‡‰å¼ */
        @media (max-width: 1000px) {
            .grid-top, .grid-mid, .grid-bottom { grid-template-columns: 1fr; height: auto; }
            .card { height: 500px; margin-bottom: 20px; }
        }
    </style>
</head>
<body>

<div class="container">
    <div class="header">
        <h1>ğŸ‡¹ğŸ‡¼ å°è‚¡ AI æˆ°æƒ…å®¤ v5.2</h1>
        <div class="subtitle">æŠ€è¡“åˆ†æ â€¢ åŸºæœ¬é¢ â€¢ å®è§€é¢¨æ§</div>
    </div>

    <div class="controls">
        <div class="search-box">
            <input type="text" id="symbol-input" class="search-input" placeholder="è¼¸å…¥ä»£ç¢¼ (ä¾‹: 8422, 2330)..." value="8422">
            <button class="search-btn" onclick="runSearch()">åˆ†æ</button>
        </div>

        <div class="btn-group">
            <button class="btn active" onclick="loadStock('TWSE:8422', 'å¯å¯§è¡›')">8422 å¯å¯§è¡›</button>
            <button class="btn" onclick="loadStock('TWSE:2330', 'å°ç©é›»')">2330 å°ç©é›»</button>
            <button class="btn" onclick="loadStock('TWSE:2603', 'é•·æ¦®')">2603 é•·æ¦®</button>
            <button class="btn" onclick="loadStock('TAIFEX:CDF1!', 'å°ç©æœŸ (CDF)')">å°ç©æœŸ (CDF)</button>
            <button class="btn" onclick="loadStock('TAIFEX:TX1!', 'å°æŒ‡æœŸ (TX)')">å°æŒ‡æœŸ (TX)</button>
        </div>

        <div class="btn-group">
            <button class="btn" onclick="changeTime('60')">1H</button>
            <button class="btn active" onclick="changeTime('D')">æ—¥ç·š (1D)</button>
            <button class="btn" onclick="changeTime('W')">é€±ç·š (1W)</button>
            <button class="btn" onclick="changeTime('M')">æœˆç·š (1M)</button>
        </div>
    </div>

    <div class="grid-top">
        <div class="card">
            <div id="chart-container" class="widget-content"></div>
        </div>
        
        <div class="card">
            <div class="card-header">
                <span>âš¡ æŠ€è¡“æŒ‡é‡è¨Šè™Ÿ</span>
                <div class="btn-group" style="zoom: 0.8;">
                    <button class="btn" onclick="updateGauge('60')">1H</button>
                    <button class="btn active" onclick="updateGauge('1D')">1D</button>
                    <button class="btn" onclick="updateGauge('1M')">1M</button>
                </div>
            </div>
            <div id="gauge-container" class="widget-content"></div>
        </div>
    </div>

    <div class="grid-mid">
        <div class="card">
            <div class="card-header">ğŸ“Š è²¡å‹™æ•¸æ“š (Financials)</div>
            <div id="financial-container" class="widget-content"></div>
        </div>
        
        <div class="card">
            <div class="card-header">ğŸ¢ å…¬å¸æ¦‚æ³ (Profile)</div>
            <div id="profile-container" class="widget-content"></div>
        </div>
    </div>

    <h2 style="color:#eee; margin:20px 0 15px 0; border-left:5px solid #FF5252; padding-left:15px; font-size:1.5rem;">ğŸŒ å…¨çƒå®è§€é¢¨æ§ (Macro Risks)</h2>
    
    <div class="grid-bottom">
        <div class="card">
            <div class="card-header">
                <span>ğŸ“… é—œéµè²¡ç¶“æ—¥æ›† (åƒ…é¡¯ç¤º USD é«˜é¢¨éšªäº‹ä»¶)</span>
                <span class="badge">High Impact</span>
            </div>
            <div class="widget-content">
                <div id="calendar-container" class="tradingview-widget-container" style="width:100%;height:100%"></div>
            </div>
        </div>

        <div class="card" style="padding:20px; overflow-y:auto; background:#1e222d;">
            <h3 style="margin-top:0; color:#FF5252; border-bottom:1px solid #444; padding-bottom:10px;">âš¡ æ•¸æ“šäº¤æ˜“ç­–ç•¥</h3>
            
            <div class="strategy-text">
                <div style="margin-bottom:20px;">
                    <strong>1. CPI (é€šè†¨æ•¸æ“š)</strong>
                    <p>
                        æ¯æœˆæœˆä¸­ç™¼å¸ƒã€‚å½±éŸ¿è¯æº–æœƒå‡æ¯æ„é¡˜ã€‚<br>
                        <span style="color:#FF5252;">â–² é«˜æ–¼é æœŸ</span>ï¼šé€šè†¨æœªé€€ â†’ æå‡æ¯ â†’ ç¾è‚¡è·Œ â†’ <strong>å°è‚¡é–‹ä½</strong><br>
                        <span style="color:#0ECB81;">â–¼ ä½æ–¼é æœŸ</span>ï¼šé€šè†¨é™æº« â†’ è³‡é‡‘å¯¬é¬† â†’ ç¾è‚¡æ¼² â†’ <strong>å°è‚¡é–‹é«˜</strong>
                    </p>
                </div>

                <div style="margin-bottom:20px;">
                    <strong>2. éè¾²å°±æ¥­ (NFP)</strong>
                    <p>
                        æ¯æœˆç¬¬ä¸€å€‹é€±äº”ã€‚åæ˜ ç¾åœ‹ç¶“æ¿Ÿå¼·åº¦ã€‚<br>
                        <span>æ•¸æ“šéç†±</span>ï¼šå°±æ¥­å¤ªå¼· â†’ å¼•ç™¼å‡æ¯æ“”æ†‚ (è·Œ)<br>
                        <span>æ•¸æ“šéå†·</span>ï¼šç¶“æ¿Ÿè¡°é€€ â†’ è³‡é‡‘æ’¤é›¢ (è·Œ)
                    </p>
                </div>

                <div style="margin-bottom:20px;">
                    <strong>3. FOMC (åˆ©ç‡æ±ºè­°)</strong>
                    <p>
                        æ¯å¹´8æ¬¡ã€‚é®‘çˆ¾è¬›è©±æœŸé–“æ³¢å‹•æ¥µå¤§ã€‚<br>
                        <span style="color:#FFCA28;">âš ï¸ é¢¨æ§å»ºè­°</span>ï¼šç™¼å¸ƒå‰å¾Œ 30 åˆ†é˜ï¼Œå»ºè­°<strong>æ¸…ç©ºæœŸè²¨å€‰ä½</strong>ï¼Œé¿å…ä¸Šä¸‹æ’é‡æƒæã€‚
                    </p>
                </div>
            </div>
            
            <div style="margin-top:auto; padding-top:10px; border-top:1px solid #444; text-align:center; font-size:0.8rem; color:#666;">
                *å°è‚¡èµ°å‹¢é€šå¸¸æœƒå»¶é²åæ‡‰ç¾è‚¡å¤œç›¤æ³¢å‹•
            </div>
        </div>
    </div>
</div>

<script>
    let currentSymbol = 'TWSE:8422';
    let currentTimeframe = 'D'; 

    window.onload = function() {
        loadStock('TWSE:8422', 'å¯å¯§è¡›');
        initCalendar(); // åˆå§‹åŒ–æ—¥æ›†
    };

    function runSearch() {
        let val = document.getElementById('symbol-input').value.toUpperCase().trim();
        if(!val) return;
        let symbol = val;
        if(/^\d{4}$/.test(val)) symbol = 'TWSE:' + val;
        if(val.includes('1!') || val.startsWith('TX') || val.startsWith('CDF')) {
            if(!val.includes(':')) symbol = 'TAIFEX:' + val;
        }
        loadStock(symbol, val);
    }

    function loadStock(symbol, name) {
        currentSymbol = symbol;
        document.querySelectorAll('.btn').forEach(b => b.classList.remove('active'));
        // ç°¡å–®é«˜äº®ç•¶å‰æŒ‰éˆ•é‚è¼¯ (å¯é¸)
        
        refreshAllWidgets();
    }

    function changeTime(tf) {
        currentTimeframe = tf;
        refreshAllWidgets();
    }

    function refreshAllWidgets() {
        document.getElementById('chart-container').innerHTML = '';
        document.getElementById('gauge-container').innerHTML = '';
        document.getElementById('financial-container').innerHTML = '';
        document.getElementById('profile-container').innerHTML = '';

        setTimeout(() => loadMainChart(), 0);
        setTimeout(() => updateGauge(currentTimeframe === 'D' ? '1D' : currentTimeframe), 200);
        setTimeout(() => loadFinancials(), 400);
        setTimeout(() => loadProfile(), 600);
    }

    // 1. ä¸»åœ–è¡¨
    function loadMainChart() {
        const script = document.createElement('script');
        script.src = 'https://s3.tradingview.com/external-embedding/embed-widget-symbol-overview.js';
        script.async = true;
        script.innerHTML = JSON.stringify({
            "symbols": [[ currentSymbol + "|" + (currentTimeframe==='60'?'60':(currentTimeframe==='240'?'240':'1D')) ]],
            "chartOnly": false,
            "width": "100%",
            "height": "100%",
            "locale": "zh_TW",
            "colorTheme": "dark",
            "autosize": true,
            "showVolume": true,
            "hideDateRanges": false,
            "scalePosition": "right",
            "scaleMode": "Normal",
            "fontFamily": "Microsoft JhengHei, sans-serif",
            "noTimeScale": false,
            "valuesTracking": "1",
            "changeMode": "price-and-percent",
            "chartType": "candlesticks",
            "maLineColor": "#2962FF",
            "maLineWidth": 1,
            "maLength": 9,
            "lineWidth": 2,
            "lineType": 0,
            "dateRanges": [ "1d|1", "1m|30", "3m|60", "12m|1D", "60m|1W", "all|1M" ]
        });
        document.getElementById('chart-container').appendChild(script);
    }

    // 2. æŠ€è¡“æŒ‡é‡
    function updateGauge(interval) {
        let tvInterval = interval;
        if(interval === 'D') tvInterval = '1D';
        if(interval === 'W') tvInterval = '1W';
        if(interval === 'M') tvInterval = '1M';

        const container = document.getElementById('gauge-container');
        container.innerHTML = '';
        const div = document.createElement('div');
        div.className = 'tradingview-widget-container';
        div.style.width = '100%'; div.style.height = '100%';
        div.innerHTML = '<div class="tradingview-widget-container__widget" style="width:100%;height:100%"></div>';
        const script = document.createElement('script');
        script.src = 'https://s3.tradingview.com/external-embedding/embed-widget-technical-analysis.js';
        script.async = true;
        script.innerHTML = JSON.stringify({
            "interval": tvInterval, "width": "100%", "height": "100%", "isTransparent": true, "symbol": currentSymbol, "showIntervalTabs": false, "displayMode": "single", "locale": "zh_TW", "colorTheme": "dark"
        });
        div.appendChild(script);
        container.appendChild(div);
    }

    // 3. è²¡å‹™
    function loadFinancials() {
        const script = document.createElement('script');
        script.src = 'https://s3.tradingview.com/external-embedding/embed-widget-financials.js';
        script.async = true;
        script.innerHTML = JSON.stringify({
            "colorTheme": "dark", "isTransparent": true, "displayMode": "regular", "width": "100%", "height": "100%", "symbol": currentSymbol, "locale": "zh_TW"
        });
        document.getElementById('financial-container').appendChild(script);
    }

    // 4. Profile
    function loadProfile() {
        const script = document.createElement('script');
        script.src = 'https://s3.tradingview.com/external-embedding/embed-widget-symbol-profile.js';
        script.async = true;
        script.innerHTML = JSON.stringify({
            "width": "100%", "height": "100%", "colorTheme": "dark", "isTransparent": true, "symbol": currentSymbol, "locale": "zh_TW"
        });
        document.getElementById('profile-container').appendChild(script);
    }

    // 5. Calendar (åªé¡¯ç¤ºä¸€æ¬¡ï¼Œä¸éš¨è‚¡ç¥¨åˆ‡æ›é‡è¼‰)
    function initCalendar() {
        const container = document.getElementById('calendar-container');
        container.innerHTML = '<div class="tradingview-widget-container__widget" style="width:100%;height:100%"></div>';
        const script = document.createElement('script');
        script.src = 'https://s3.tradingview.com/external-embedding/embed-widget-events.js';
        script.async = true;
        script.innerHTML = JSON.stringify({
            "colorTheme": "dark",
            "isTransparent": true,
            "width": "100%",
            "height": "100%",
            "locale": "zh_TW",
            "importanceFilter": "-1,0", // åªé¡¯ç¤ºé«˜é‡è¦æ€§
            "currencyFilter": "USD" // é–å®šç¾å…ƒ
        });
        container.appendChild(script);
    }
</script>

</body>
</html>
